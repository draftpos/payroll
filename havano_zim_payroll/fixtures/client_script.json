[
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "havano_salary_component",
  "enabled": 1,
  "modified": "2025-11-14 16:38:55.754857",
  "module": "Havano Zim Payroll",
  "name": "havano_salary_component_medical",
  "script": "frappe.ui.form.on('havano_salary_component', {\n    component_mode: function(frm) {\n        // NEC / Medical Aid Section\n        if (frm.doc.component_mode === 'Medical Aid' || frm.doc.component_mode=== \"allowable_deduction\") {\n            frm.set_df_property('section_break_mgmx', 'hidden', false);\n        } else {\n            frm.set_df_property('section_break_mgmx', 'hidden', true);\n\n        }\n\n        // NSSA Section\n        if (frm.doc.component_mode === 'NSSA') {\n            frm.set_df_property('nassa_cieling_section', 'hidden', false);\n        } else {\n            frm.set_df_property('nassa_cieling_section', 'hidden', true);\n\n        }\n    },\n    refresh: function(frm) {\n        frm.trigger('component_mode');\n    }\n});\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "havano_salary_structure",
  "enabled": 1,
  "modified": "2025-10-17 16:27:03.545870",
  "module": "Havano Zim Payroll",
  "name": "filter earnin",
  "script": "frappe.ui.form.on('havano_salary_structure', {\n    setup: function(frm) {\n        // Helper function to set up filters for both tables\n        function set_component_filter(child_table_name, component_type) {\n            frm.fields_dict[child_table_name].grid.get_field('components').get_query = function(doc, cdt, cdn) {\n                return {\n                    filters: [\n                        ['type', '=', component_type],\n                        ['company', '=', frm.doc.company],\n                        // Nested child table condition:\n                        // Only include components whose linked \"account\" child table has matching company\n                        ['havano_salary_accounts', 'company', '=', frm.doc.company]\n                    ]\n                };\n            };\n        }\n\n        // ðŸ”¹ Apply for Earnings\n        set_component_filter('earnings', 'Earning');\n\n        // ðŸ”¹ Apply for Deductions\n        set_component_filter('deductions', 'Deduction');\n    }\n});\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "havano_employee",
  "enabled": 1,
  "modified": "2025-10-17 17:02:13.043431",
  "module": "Havano Zim Payroll",
  "name": "havano_employee_filter",
  "script": "frappe.ui.form.on('havano_employee', {\n    setup: function(frm) {\n        // Helper function to set up filters for both tables\n        function set_component_filter(child_table_name, component_type) {\n            frm.fields_dict[child_table_name].grid.get_field('components').get_query = function(doc, cdt, cdn) {\n                return {\n                    filters: [\n                        ['type', '=', component_type],\n                        ['company', '=', frm.doc.company],\n                        // Nested child table condition:\n                        // Only include components whose linked \"account\" child table has matching company\n                        ['havano_salary_accounts', 'company', '=', frm.doc.company]\n                    ]\n                };\n            };\n        }\n\n        // ðŸ”¹ Apply for Earnings\n        set_component_filter('employee_earnings', 'Earning');\n\n        // ðŸ”¹ Apply for Deductions\n        set_component_filter('employee_deductions', 'Deduction');\n    }\n});\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "havano_employee",
  "enabled": 1,
  "modified": "2025-10-21 08:41:46.843544",
  "module": "Havano Zim Payroll",
  "name": "havano_employee_currency_change",
  "script": "frappe.ui.form.on('havano_employee', {\n    onload(frm) {\n        toggle_sections(frm);\n    },\n\n    refresh(frm) {\n        toggle_sections(frm);\n    },\n\n    payslip_type(frm) {\n        toggle_sections(frm);\n    }\n});\n\nfunction toggle_sections(frm) {\n    const payslip_type = frm.doc.payslip_type;\n\n    // Show these only for Base Currency\n    const show_base = payslip_type === \"Base Currency\";\n    frm.toggle_display('hidden_calculations_section', show_base);\n    frm.toggle_display('net_income_section', show_base);\n\n    // Show these only for Split Currency\n    const show_split = payslip_type === \"Split Currency\";\n    frm.toggle_display('all_net_incomes_section', show_split);\n    frm.toggle_display('double_calculations_section', show_split);\n}\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "havano_employee",
  "enabled": 1,
  "modified": "2025-10-21 09:46:20.816077",
  "module": "Havano Zim Payroll",
  "name": "payslip",
  "script": "frappe.ui.form.on('havano_employee', {\n    refresh(frm) {\n        if(!frm.is_new()) {\n            frm.add_custom_button('Generate Payslip', () => {\n                frappe.call({\n                    method: \"frappe.client.get\",\n                    args: {\n                        doctype: frm.doc.doctype,\n                        name: frm.doc.name\n                    },\n                    callback: function(r) {\n                        const html = frappe.render_template(\"Havano Employee Payslip\", { doc: r.message });\n                        const w = window.open('', '_blank');\n                        w.document.write(html);\n                        w.document.close();\n                        w.focus();\n                        w.print();\n                    }\n                });\n            });\n        }\n    }\n});\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Havano Payroll Entry",
  "enabled": 1,
  "modified": "2025-10-31 08:28:09.653146",
  "module": "Havano Zim Payroll",
  "name": "payroll entry",
  "script": "frappe.listview_settings['Havano Payroll Entry'] = {\n    onload(listview) {\n        listview.page.add_inner_button('Run Payroll', () => {\n            let d = new frappe.ui.Dialog({\n                title: \"Run Payroll\",\n                fields: [\n                    {\n                        label: \"Month\",\n                        fieldname: \"month\",\n                        fieldtype: \"Select\",\n                        options: [\n                            \"January\", \"February\", \"March\", \"April\",\n                            \"May\", \"June\", \"July\", \"August\",\n                            \"September\", \"October\", \"November\", \"December\"\n                        ],\n                        reqd: 1\n                    },\n                    {\n                        label: \"Year\",\n                        fieldname: \"year\",\n                        fieldtype: \"Int\",\n                        reqd: 1,\n                        default: new Date().getFullYear()\n                    }\n                ],\n                primary_action_label: \"Run Payroll\",\n                primary_action(values) {\n                      frappe.call({\n                            method: \"havano_zim_payroll.api.run_payroll\",\n                            args: { month: values.month, year: values.year },\n                            callback(r) {\n                                frappe.msgprint(r.message);\n                            }\n                        });\n                        d.hide();\n                }\n            });\n\n            // make the \"Run Payroll\" button blue\n            d.$wrapper.find('.btn-primary').addClass('btn-primary');\n\n            d.show();\n        });\n    }\n};\n",
  "view": "List"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "havano_employee",
  "enabled": 1,
  "modified": "2025-11-12 14:20:39.268325",
  "module": "Havano Zim Payroll",
  "name": "overtime type",
  "script": "frappe.ui.form.on(\"havano_employee\", {\n    overtime(frm) {\n        let value = frm.doc.overtime;\n\n        if (value === \"Short Time\") {\n            frm.fields_dict.formula_display.$wrapper.html(\"<b>Formula:</b> (= hourly rate * hours worked * 1.5)\");\n        } else if (value === \"Double Time\") {\n            frm.fields_dict.formula_display.$wrapper.html(\"<b>Formula:</b> (= hourly rate * hours worked * 2)\");\n        } else {\n            frm.fields_dict.formula_display.$wrapper.html(\"<b>Formula:</b> Select overtime type to view calculation</b>\");\n        }\n    },\n});\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Employee Payment Processing",
  "enabled": 1,
  "modified": "2025-11-14 10:32:36.025240",
  "module": "Havano Zim Payroll",
  "name": "get employees",
  "script": "frappe.ui.form.on(\"Employee Payment Processing\", {\n    refresh: function(frm) {\n        frm.add_custom_button(__('Get Employees'), function() {\n            if (!frm.doc.company || !frm.doc.branch || !frm.doc.department) {\n                frappe.msgprint(__('Please select Company, Branch, and Department first.'));\n                return;\n            }\n\n            frappe.call({\n                method: \"havano_zim_payroll.havano_zim_payroll.doctype.employee_payment_processing.employee_payment_processing.get_employees_with_ledger\",\n                args: {\n                    company: frm.doc.company,\n                    branch: frm.doc.branch,\n                    department: frm.doc.department\n                },\n                callback: function(r) {\n                    if (r.message) {\n                        frm.clear_table(\"employee\");\n                        r.message.forEach(emp => {\n                            let row = frm.add_child(\"employee\");\n                            console.log(emp);\n                            row.employee = emp.employee;\n                            row.employee_name=emp.employee_name;\n                            row.amount_payable = emp.current_balance_owing;\n                        });\n                        frm.refresh_field(\"employee\");\n                        frappe.msgprint(__('Employees loaded successfully.'));\n                    } else {\n                        frappe.msgprint(__('No employees found.'));\n                    }\n                }\n            });\n        });\n    }\n});\n",
  "view": "Form"
 }
]